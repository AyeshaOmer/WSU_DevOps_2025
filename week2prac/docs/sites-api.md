# Sites CRUD API Documentation\n\nThis document describes the REST API for managing website monitoring targets.\n\n## Base URL\n\nAfter deployment, the API will be available at:\n```\nhttps://{api-gateway-id}.execute-api.{region}.amazonaws.com/{stage}/\n```\n\n## Authentication\n\nCurrently, the API does not require authentication. In production, you should implement API keys, IAM authentication, or other security mechanisms.\n\n## Content Type\n\nAll requests and responses use JSON format:\n```\nContent-Type: application/json\n```\n\n## CORS Support\n\nThe API includes CORS headers for web application integration:\n- `Access-Control-Allow-Origin: *`\n- `Access-Control-Allow-Methods: GET, POST, PUT, DELETE, OPTIONS`\n- `Access-Control-Allow-Headers: Content-Type, X-Amz-Date, Authorization, X-Api-Key`\n\n## Endpoints\n\n### List All Sites\n\n**GET** `/sites`\n\nRetrieve a list of all website monitoring targets.\n\n#### Response\n\n**Success (200):**\n```json\n{\n  \"sites\": [\n    {\n      \"site_id\": \"550e8400-e29b-41d4-a716-446655440000\",\n      \"url\": \"https://example.com\",\n      \"name\": \"Example Site\",\n      \"description\": \"Example website for monitoring\",\n      \"tags\": [\"production\", \"web\"],\n      \"enabled\": true,\n      \"created_at\": \"2025-01-01T00:00:00Z\",\n      \"updated_at\": \"2025-01-01T00:00:00Z\"\n    }\n  ],\n  \"count\": 1\n}\n```\n\n**Error (500):**\n```json\n{\n  \"error\": \"Failed to retrieve sites\",\n  \"statusCode\": 500\n}\n```\n\n---\n\n### Create New Site\n\n**POST** `/sites`\n\nCreate a new website monitoring target.\n\n#### Request Body\n\n```json\n{\n  \"url\": \"https://example.com\",           // Required: Website URL\n  \"name\": \"Example Site\",                 // Optional: Display name (defaults to URL)\n  \"description\": \"Test site\",             // Optional: Description\n  \"tags\": [\"test\", \"example\"],           // Optional: Array of tags\n  \"enabled\": true                         // Optional: Enable/disable monitoring (defaults to true)\n}\n```\n\n#### Response\n\n**Success (201):**\n```json\n{\n  \"site_id\": \"550e8400-e29b-41d4-a716-446655440000\",\n  \"url\": \"https://example.com\",\n  \"name\": \"Example Site\",\n  \"description\": \"Test site\",\n  \"tags\": [\"test\", \"example\"],\n  \"enabled\": true,\n  \"created_at\": \"2025-01-01T00:00:00Z\",\n  \"updated_at\": \"2025-01-01T00:00:00Z\"\n}\n```\n\n**Error (400) - Missing URL:**\n```json\n{\n  \"error\": \"url is required\",\n  \"statusCode\": 400\n}\n```\n\n**Error (400) - Invalid URL:**\n```json\n{\n  \"error\": \"url must start with http:// or https://\",\n  \"statusCode\": 400\n}\n```\n\n**Error (409) - Duplicate URL:**\n```json\n{\n  \"error\": \"Site with URL https://example.com already exists\",\n  \"statusCode\": 409\n}\n```\n\n---\n\n### Get Single Site\n\n**GET** `/sites/{site_id}`\n\nRetrieve details for a specific site.\n\n#### Path Parameters\n\n- `site_id` (string): UUID of the site\n\n#### Response\n\n**Success (200):**\n```json\n{\n  \"site_id\": \"550e8400-e29b-41d4-a716-446655440000\",\n  \"url\": \"https://example.com\",\n  \"name\": \"Example Site\",\n  \"description\": \"Test site\",\n  \"tags\": [\"test\", \"example\"],\n  \"enabled\": true,\n  \"created_at\": \"2025-01-01T00:00:00Z\",\n  \"updated_at\": \"2025-01-01T00:00:00Z\"\n}\n```\n\n**Error (404):**\n```json\n{\n  \"error\": \"Site with ID 550e8400-e29b-41d4-a716-446655440000 not found\",\n  \"statusCode\": 404\n}\n```\n\n---\n\n### Update Site\n\n**PUT** `/sites/{site_id}`\n\nUpdate an existing site. Only provided fields will be updated.\n\n#### Path Parameters\n\n- `site_id` (string): UUID of the site\n\n#### Request Body\n\n```json\n{\n  \"url\": \"https://updated-example.com\",    // Optional: New URL\n  \"name\": \"Updated Site Name\",            // Optional: New name\n  \"description\": \"Updated description\",   // Optional: New description\n  \"tags\": [\"updated\", \"test\"],           // Optional: New tags array\n  \"enabled\": false                        // Optional: Enable/disable\n}\n```\n\n#### Response\n\n**Success (200):**\n```json\n{\n  \"site_id\": \"550e8400-e29b-41d4-a716-446655440000\",\n  \"url\": \"https://updated-example.com\",\n  \"name\": \"Updated Site Name\",\n  \"description\": \"Updated description\",\n  \"tags\": [\"updated\", \"test\"],\n  \"enabled\": false,\n  \"created_at\": \"2025-01-01T00:00:00Z\",\n  \"updated_at\": \"2025-01-01T01:00:00Z\"\n}\n```\n\n**Error (404):**\n```json\n{\n  \"error\": \"Site with ID 550e8400-e29b-41d4-a716-446655440000 not found\",\n  \"statusCode\": 404\n}\n```\n\n**Error (409) - Duplicate URL:**\n```json\n{\n  \"error\": \"Another site with URL https://existing.com already exists\",\n  \"statusCode\": 409\n}\n```\n\n---\n\n### Delete Site\n\n**DELETE** `/sites/{site_id}`\n\nDelete a site from monitoring.\n\n#### Path Parameters\n\n- `site_id` (string): UUID of the site\n\n#### Response\n\n**Success (200):**\n```json\n{\n  \"message\": \"Site 550e8400-e29b-41d4-a716-446655440000 deleted successfully\",\n  \"site_id\": \"550e8400-e29b-41d4-a716-446655440000\"\n}\n```\n\n**Error (404):**\n```json\n{\n  \"error\": \"Site with ID 550e8400-e29b-41d4-a716-446655440000 not found\",\n  \"statusCode\": 404\n}\n```\n\n## Data Model\n\n### Site Object\n\n| Field | Type | Required | Description |\n|-------|------|----------|-------------|\n| `site_id` | string (UUID) | Auto-generated | Unique identifier |\n| `url` | string | Required | Website URL (must start with http:// or https://) |\n| `name` | string | Optional | Display name (defaults to URL) |\n| `description` | string | Optional | Description of the site |\n| `tags` | array of strings | Optional | Tags for categorization |\n| `enabled` | boolean | Optional | Whether monitoring is enabled (defaults to true) |\n| `created_at` | string (ISO 8601) | Auto-generated | Creation timestamp |\n| `updated_at` | string (ISO 8601) | Auto-generated | Last update timestamp |\n\n## Error Handling\n\n### HTTP Status Codes\n\n- `200` - Success\n- `201` - Created\n- `400` - Bad Request (invalid data, missing required fields)\n- `404` - Not Found\n- `405` - Method Not Allowed\n- `409` - Conflict (duplicate URL)\n- `500` - Internal Server Error\n\n### Error Response Format\n\nAll error responses follow this format:\n```json\n{\n  \"error\": \"Human-readable error message\",\n  \"statusCode\": 400\n}\n```\n\n## Usage Examples\n\n### cURL Examples\n\n#### Create a new site\n```bash\ncurl -X POST \"https://api.example.com/sites\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"url\": \"https://example.com\",\n    \"name\": \"Example Site\",\n    \"tags\": [\"production\"]\n  }'\n```\n\n#### List all sites\n```bash\ncurl -X GET \"https://api.example.com/sites\"\n```\n\n#### Get a specific site\n```bash\ncurl -X GET \"https://api.example.com/sites/550e8400-e29b-41d4-a716-446655440000\"\n```\n\n#### Update a site\n```bash\ncurl -X PUT \"https://api.example.com/sites/550e8400-e29b-41d4-a716-446655440000\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"name\": \"Updated Site Name\",\n    \"enabled\": false\n  }'\n```\n\n#### Delete a site\n```bash\ncurl -X DELETE \"https://api.example.com/sites/550e8400-e29b-41d4-a716-446655440000\"\n```\n\n### JavaScript Examples\n\n#### Using fetch API\n\n```javascript\n// Create a new site\nconst createSite = async () => {\n  const response = await fetch('https://api.example.com/sites', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n    },\n    body: JSON.stringify({\n      url: 'https://example.com',\n      name: 'Example Site',\n      tags: ['production']\n    })\n  });\n  \n  const site = await response.json();\n  console.log('Created site:', site);\n};\n\n// List all sites\nconst listSites = async () => {\n  const response = await fetch('https://api.example.com/sites');\n  const data = await response.json();\n  console.log(`Found ${data.count} sites:`, data.sites);\n};\n\n// Update a site\nconst updateSite = async (siteId) => {\n  const response = await fetch(`https://api.example.com/sites/${siteId}`, {\n    method: 'PUT',\n    headers: {\n      'Content-Type': 'application/json',\n    },\n    body: JSON.stringify({\n      enabled: false\n    })\n  });\n  \n  const updatedSite = await response.json();\n  console.log('Updated site:', updatedSite);\n};\n```\n\n## Integration with Website Monitor\n\nOnce deployed, the monitor Lambda function can be optionally updated to read site targets from this DynamoDB table instead of the static `sites.json` file. This would provide dynamic monitoring target management through the API.\n\n## Security Considerations\n\n1. **Authentication**: Consider implementing API keys, IAM authentication, or OAuth for production use\n2. **Rate Limiting**: Implement rate limiting to prevent abuse\n3. **Input Validation**: All inputs are validated, but consider additional sanitization\n4. **CORS**: Currently allows all origins (`*`) - restrict for production\n5. **HTTPS**: Ensure API is only accessible over HTTPS\n6. **Logging**: Consider adding detailed logging for audit trails\n\n## Deployment Notes\n\n- The API is deployed using AWS API Gateway with Lambda integration\n- DynamoDB table uses pay-per-request billing for cost efficiency\n- All resources include stage-specific suffixes to avoid conflicts\n- Integration tests require `SITES_API_URL` environment variable to be set